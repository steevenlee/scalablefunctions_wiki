This section describes how to use DPDK based VDPA device of SF auxiliary device which were configured in `step by step guide <https://github.com/Mellanox/scalablefunctions/wiki/Upstream-step-by-step-guide>`_.

VDPA devices are managed by vdpa management tool from the iproute2 package.
Its `man page <https://man7.org/linux/man-pages/man8/vdpa.8.html>`_ provides more detailed command options.

1. List and view SF device
--------------------------
1.1  View the auxiliary device of the SF
=========================================
There can be hundreds of auxiliary SF devices on the auxiliary bus.
Each SF's auxiliary device contains a unique sfnum and PCI information.

Parent PCI BDF (Bus, Device, Function) and the SF number establishes a unique SF device.

Each SF's sfnum can be read using:
::

  $ cat /sys/bus/auxiliary/devices/mlx5_core.sf.4/sfnum
  88

1.3  View the RDMA device of the vdpa device
==============================================
::

  $ ls /sys/bus/auxiliary/devices/mlx5_core.sf.4/infiniband/
  mlx5_4

1.4 Build DPDK with vdpa example enabled.
==============================================
Add folowing parameter to meson command when configuring dpdk, then build:
::

  $ meson -Dexamples=vdpa -Dbuildtype=debug /tmp/build
  $ ninja -C /tmp/build

1.5 Use DPDK testpmd between forward SF representor port and PF
================================================================
DPDK testpmd starts as io fowarding mode by default if only two ports probled.
::

  $ /tmp/build/app/dpdk-testpmd --file-prefix=xx -w 0000:03:00.0,representor=sf88  -- --stats-period=1

`DPDK step by step guide <https://doc.dpdk.org/guides/vdpadevs/mlx5.html>`_.

1.6  Use DPDK based vdpa device for the SF
============================================
Start DPDK vdpa example with SF devices:
::

  $ /tmp/build/examples/dpdk-vdpa -w auxiliary:mlx5_core.sf.4,class=vdpa -- --iface /tmp/vhost-user-

`DPDK mlx5 VDPA guide <https://doc.dpdk.org/guides/vdpadevs/mlx5.html>`_.

1.7 Traffic test
==================
Start up qemu with vdpa interface, configure virtio interface ip and ping remote side, the traffice
should be captured on wire.

