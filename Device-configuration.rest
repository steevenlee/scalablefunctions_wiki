Scalable functions are disabled by default in the device. User must enable them when they want to use it.

Scalable functions have very little device configuration.
It includes enabling total number of scalable functions and PCI BAR size.

Scalable function configuration is done using `mlxconfig <https://docs.mellanox.com/pages/viewpage.action?pageId=19811008>`_
tool.

Quick example
--------------
To configure 236 SFs per PCI device with BAR size of 1MBytes::

$ mlxconfig -d 0000:03:00.0 s PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=236 PF_SF_BAR_SIZE=10

Note: SF configuration is a per PCI device config. So if 2nd PCI function needs SFs, user must enable it explicitly on 2nd PF as well.
Such as::

$ mlxconfig -d 0000:03:00.1 s PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=236 PF_SF_BAR_SIZE=10

Description
-----------
1. Total/maximum number of scalable functions per PCI PF
This is controlled using PF_TOTAL_SF.

2. PCI BAR size per scalable function
This is controlled using PF_SF_BAR_SIZE.

When using DPU Bluefield-2, DPU software hotplug and unplug a scalable function in the external (a.k.a bare metal) host system.
To use scalable functions in the external host system which managed by DPU software, user must perform SF configuration in the external bare-metal host PF where containers use the SF.

Device Support matrix and config
---------------------------------
.. list-table:: Device support matrix
   :widths: 8 8 10 10 8 20 20

   * - Device
     - Minimum firmware version
     - Maximum scalable functions (on eswitch PF)
     - Maximum scalable functions (on bare-metal host PF)
     - Maximum virtual functions
     - Config (mlxconfig) on eswitch PF
     - Config (mlxconfig) on bare-metal host PF
   * - DPU Bluefield-2
     -  24.30.1004
     - 2
     - 500
     - 0
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=2 PF_SF_BAR_SIZE=10 SRIOV_EN=0
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=500 PF_SF_BAR_SIZE=10 SRIOV_EN=0 NUM_OF_VFS=0
   * - DPU Bluefield-2
     -  24.30.1004
     - 500
     - 0
     - 0
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=500 PF_SF_BAR_SIZE=10 SRIOV_EN=0
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=0 SRIOV_EN=0 NUM_OF_VFS=0
   * - ConnectX-6-DX
     -  20.30.1004
     - 236
     - not applicable
     - 16
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=236 PF_SF_BAR_SIZE=10 SRIOV_EN=1 NUM_OF_VFS=16
     - not applicable
   * - ConnectX-6-DX
     -  22.30.1004
     - 253
     - not applicable
     - 0
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=253 PF_SF_BAR_SIZE=10 SRIOV_EN=0
     - not applicable
   * - ConnectX-6-DX
     -  22.30.1004
     - 0
     - not applicable
     - 16
     - PF_TOTAL_SF=0 PER_PF_NUM_SF=1 SRIOV_EN=1 NUM_OF_VFS=16
     - not applicable
   * - ConnectX-6
     - 20.30.1004
     - 236
     - not applicable
     - 16
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=236 PF_SF_BAR_SIZE=10 SRIOV_EN=1 NUM_OF_VFS=16
     - not applicable
   * - ConnectX-5
     - 16.30.1004
     - 236
     - not applicable
     - 16
     - PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=236 PF_SF_BAR_SIZE=10 SRIOV_EN=1 NUM_OF_VFS=16
     - not applicable